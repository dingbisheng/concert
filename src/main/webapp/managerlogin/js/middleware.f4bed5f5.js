(function(){!function(e,t,n){var o=function(e,t,n,o){var r=e(t);e.fn.lazyload=function(i){function a(){var t=0;l.each(function(){var n=e(this);if(!f.skip_invisible||n.is(":visible"))if(e.abovethetop(this,f)||e.leftofbegin(this,f));else if(e.belowthefold(this,f)||e.rightoffold(this,f)){if(++t>f.failure_limit)return!1}else n.trigger("appear"),t=0})}var c,l=this,f={handler:function(e){return e},threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!1,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return i&&(o!==i.failurelimit&&(i.failure_limit=i.failurelimit,delete i.failurelimit),o!==i.effectspeed&&(i.effect_speed=i.effectspeed,delete i.effectspeed),e.extend(f,i)),c=f.container===o||f.container===t?r:e(f.container),0===f.event.indexOf("scroll")&&c.bind(f.event,function(){return a()}),this.each(function(){var t=this,n=e(t);t.loaded=!1,n.attr("src")!==o&&n.attr("src")!==!1||n.is("img")&&n.attr("src",f.placeholder),n.one("appear",function(){if(!this.loaded){if(f.appear){var o=l.length;f.appear.call(t,o,f)}e("<img />").bind("load",function(){var o=n.attr("data-"+f.data_attribute);n.hide(),n.is("img")?(o=f.handler(o),n.attr("src",o)):n.css("background-image","url('"+o+"')"),n[f.effect](f.effect_speed),t.loaded=!0;var r=e.grep(l,function(e){return!e.loaded});if(l=e(r),f.load){var i=l.length;f.load.call(t,i,f)}}).attr("src",f.handler(n.attr("data-"+f.data_attribute)))}}),0!==f.event.indexOf("scroll")&&n.bind(f.event,function(){t.loaded||n.trigger("appear")})}),r.bind("resize",function(){a()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&r.bind("pageshow",function(t){t.originalEvent&&t.originalEvent.persisted&&l.each(function(){e(this).trigger("appear")})}),e(n).ready(function(){a()}),this},e.belowthefold=function(n,i){var a;return a=i.container===o||i.container===t?(t.innerHeight?t.innerHeight:r.height())+r.scrollTop():e(i.container).offset().top+e(i.container).height(),a<=e(n).offset().top-i.threshold},e.rightoffold=function(n,i){var a;return a=i.container===o||i.container===t?r.width()+r.scrollLeft():e(i.container).offset().left+e(i.container).width(),a<=e(n).offset().left-i.threshold},e.abovethetop=function(n,i){var a;return a=i.container===o||i.container===t?r.scrollTop():e(i.container).offset().top,a>=e(n).offset().top+i.threshold+e(n).height()},e.leftofbegin=function(n,i){var a;return a=i.container===o||i.container===t?r.scrollLeft():e(i.container).offset().left,a>=e(n).offset().left+i.threshold+e(n).width()},e.inviewport=function(t,n){return!(e.rightoffold(t,n)||e.leftofbegin(t,n)||e.belowthefold(t,n)||e.abovethetop(t,n))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})},r=function(){var n,r,i;if("undefined"!=typeof jQuery)o(jQuery,e,t);else{n=t.getElementsByTagName("img");for(var a=0;a<n.length;a++)r=n[a],i=r.getAttribute("data-original"),i&&r.setAttribute("src",i)}};r()}(window,document);var e,t,n,o,r,i,a,c,l,f,d,s,u,h,g,p,m,w,v,A,b=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};o="https://an.danlu.net/demlution.gif",e="/company_api/company_counter/",n=!1,t=!!window.DM_DEBUG,t&&(o="http://127.0.0.1:9001/demlution.gif"),l=function(e){return Math.round(Math.random()*e)},a=function(e){var t,n;return document.cookie.length>0&&(n=document.cookie.indexOf(e+"="),n!==-1)?(n=n+e.length+1,t=document.cookie.indexOf(";",n),t===-1&&(t=document.cookie.length),unescape(document.cookie.substring(n,t))):""},h=function(e,t){return document.cookie=e+"="+escape(t)},r=function(e){var t;return t=a(e),t||(t=l(1e8),h(e,t)),t},c=function(e,t){var n;return n=new Image(1,1),n.onload=function(){var e;if(e=0,"function"==typeof t)return t()},n.src=e},u=function(){var e,t,n,i;if("true"!==window.localStorage.disable_moddleware&&!/(phantomjs|baiduspider|headlesschrome)/.test(navigator.userAgent.toLowerCase())){t={id:l(1e8),referer:encodeURIComponent(document.referrer),da_a:r("da_a"),width:window.screen.width,height:window.screen.height,color:screen.colorDepth,lang:navigator.browserLanguage?navigator.browserLanguage:navigator.language,title:encodeURIComponent(document.title),token:window.DM_ANALYTICS_TOKEN||"",request_id:window.DM_REQUEST_ID,page_id:window.DM_PAGE_ID},n="";for(e in t)n+="&"+e+"="+t[e];return i=o+"?"+n.slice(1,n.length),c(i)}},A=function(e,t){var n;if(window.XMLHttpRequest)n=new XMLHttpRequest;else if(window.ActiveXObject)try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(o){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(o){}}if(n)return n.onreadystatechange=function(){return t(n)},n.open("GET",e),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.send()},w=function(){var t,n,o,r;if(t=document.getElementById("dm-company-counter"),n=[].slice.call(document.querySelectorAll(".dm-company-counter")),o=document.getElementById("dm-object-pageview"),r=[].slice.call(document.querySelectorAll(".dm-object-pageview")),t||o||n.length||r.length)return A(e,function(e){var i,a,c,l,f,d,s;if(4===e.readyState&&200===e.status){if(i=JSON.parse(e.responseText),t&&(t.innerHTML=i.counter),o&&(o.innerHTML=i.pageview),n.length)for(c=0,f=n.length;c<f;c++)a=n[c],a.innerHTML=i.counter;if(r.length){for(s=[],l=0,d=r.length;l<d;l++)a=r[l],s.push(a.innerHTML=i.pageview);return s}}})},m=function(){var e;if(e=document.createElement("canvas"),e.getContext&&e.getContext("2d"))return n=!(0!==e.toDataURL("image/webp").indexOf("data:image/webp"))},p=function(){var e,t;if(window.WOW&&window.D&&"standand"===window.D.platform&&(new WOW).init(),"undefined"!=typeof jQuery)return e=/s2\.d2scdn\.com\//i,t=/s2\.d2scdn\.com\/[^?]*$/i,$("img").lazyload({threshold:200,handler:function(o){return o&&n?(o.match(t)?o+="?imageView2/0/format/webp":o.match(e)&&(o=o.replace("/format/jpg","/format/webp"),o=o.replace("/format/jpeg","/format/webp")),o):o}})},s=function(){var e,t,n,o,r;if(/__remove_href/.test(location.search)){for(o=$("a"),r=[],t=0,n=o.length;t<n;t++)e=o[t],$(e).removeAttr("href"),r.push($(e).click(function(e){return!1}));return r}},v=function(){var e,t,n,o,r,i;if(/__legacy=true/.test(location.search)&&"number"!=typeof window.DM_PAGE_ID){for(t='<div class="a-legacy-tips" style=" box-sizing: border-box; height: 30px; line-height: 30px; font-size: 12px; border: 1px solid #ccc; background-color: #FFEB3B; color: #212121; text-align: center; width: 200px; position: fixed; top: 20px; left: 20px; z-index: 9999999; "> 正在预览整站模板网站 </div>',$("body").prepend($(t)),r=$("a"),i=[],n=0,o=r.length;n<o;n++)e=r[n],e.search?/^\?/.test(e.search)?i.push(e.search+="&__legacy=true"):i.push(void 0):i.push(e.search="?__legacy=true");return i}},i=function(){},g=function(){var e,t,n,o,r;if(n=/\/product\/(\d+)\//,e=location.pathname.match(n),e&&(t=e[1],r=localStorage.getItem("viewed_product"),o=r?JSON.parse(r):[],b.call(o,t)<0))return o.unshift(e[1]),o.length>10&&(o=o.slice(0,10)),r=JSON.stringify(o),localStorage.setItem("viewed_product",r),o.length},d=function(){if(navigator.userAgent.match(/MicroMessenger/)&&location.host.indexOf("wx.danlu.net")===-1&&location.search.indexOf("wx_redirect")>-1)return window.location="/weixin/wx_redirect"},f=function(){return m(),u(),p(),w(),s(),v(),g(),d()},f(),function(){if(!/(phantomjs|headlesschrome)/.test(navigator.userAgent.toLowerCase())&&"true"!==localStorage.disable_moddleware){var e=document.createElement("script"),t=window.location.protocol.split(":")[0];"https"===t?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)}}()}).call(this);
//# sourceMappingURL=middleware.js.map
